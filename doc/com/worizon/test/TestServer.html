<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="es">
<head>
<!-- Generated by javadoc (version 1.6.0_27) on Mon Nov 11 00:50:12 CET 2013 -->
<title>TestServer</title>
<meta name="date" content="2013-11-11">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="TestServer";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TestServer.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/worizon/test/BaseServer.html" title="class in com.worizon.test"><span class="strong">PREV CLASS</span></a></li>
<li><a href="../../../com/worizon/test/TestServer.IMapper.html" title="interface in com.worizon.test"><span class="strong">NEXT CLASS</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/worizon/test/TestServer.html" target="_top">FRAMES</a></li>
<li><a href="TestServer.html" target="_top">NO FRAMES</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>SUMMARY:&nbsp;</li>
<li><a href="#nested_class_summary">NESTED</a>&nbsp;|&nbsp;</li>
<li><a href="#fields_inherited_from_class_java.lang.Thread">FIELD</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">CONSTR</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">METHOD</a></li>
</ul>
<ul class="subNavList">
<li>DETAIL:&nbsp;</li>
<li>FIELD&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">CONSTR</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">METHOD</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<p class="subTitle">com.worizon.test</p>
<h2 title="Class TestServer" class="title">Class TestServer</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>java.lang.Thread</li>
<li>
<ul class="inheritance">
<li><a href="../../../com/worizon/test/BaseServer.html" title="class in com.worizon.test">com.worizon.test.BaseServer</a></li>
<li>
<ul class="inheritance">
<li>com.worizon.test.TestServer</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd>java.lang.Runnable</dd>
</dl>
<hr>
<br>
<pre>public class <strong>TestServer</strong>
extends <a href="../../../com/worizon/test/BaseServer.html" title="class in com.worizon.test">BaseServer</a></pre>
<div class="block">Single-threaded server to test Http requester classes when doing unit testing. Unlike a mocked-based approach this class lets you test 
  client http code with a real connection. So, the server accepts the incoming connection, reads http headers and body requests and closes 
  the connection. All Http headers and body sent by the client under test can be inspectionated and checked with asserts in JUnit.
  There are two ways of integrating this server into your testing plan, via an adapter method or via a proxy method.
  
  This class depends on spring-aop.jar, spring-core.jar, aopalliance.jar, commons-logging.jar
  Tested with spring-aop-3.2.4.RELEASE.jar, spring-core-3.2.4.RELEASE.jar aopalliance-1.0.jar and commons-logging-1.1.3.jar 
  
  <p>Proxy 'request' method from your MyHttpRequester class, ex:
  <pre>
        //server started and accepting connections on localhost:4444
        TestServer server = new TestServer(4444);
  
        //proxy 'request' method on your class under test
        MyHttpRequester http = (MyHttpRequester)server.createTestRequester(new MyHttpRequester(), "request");
  
        //set endpoint to localhost:port/whatever
        http.setEndpoint("http://localhost:4444/rpc");
  
        //perform request to the server, the server closes the connection after the whole request is read an silences 
        //exceptions, to avoid try/catch code pollution in your test, thrown by HttpURLConnection since it was expecting a response back.  
        http.request("test body"); 
  
        //test for headers and body sent with regular junit asserts
        assertEquals("test body", server.getBody());
        assertEquals("application/json", server.getHeaders().get("Content-Type"));
        ...
  </pre>
  
  <p>Adapt 'request' method from your MyHttpRequester class
  
  <pre>
        TestServer server = new TestServer(4444);
  
        //adapt request and endpoint to your class under test.
        server.setAdapter(new TestServer.IRequester() {
                        
                        private MyHttpRequester myRequester = new MyHttpRequester();
                        
                        public void setEndpoint(String endpoint) {
                                
                                myRequester.setEndpoint(endpoint);//my particular method to set the endpoint
                        }
                        
                        public void doRequest(String body) throws Exception {
                                
                                myRequester.request(body);//my particular method to make the request.
                        } 
                });

                TestServer.IRequester http = server.createTestRequester("http://localhost:4444/rpc");
        http.doRequest("my test body");
        assertEquals("my test body", server.getBody());
        assertEquals("application/json", server.getHeaders().get("Content-Type"));
        ...  
  </pre></div>
<dl><dt><span class="strong">Author:</span></dt>
  <dd>Enric Cecilla</dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static interface&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.IMapper.html" title="interface in com.worizon.test">TestServer.IMapper</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static interface&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.IRequester.html" title="interface in com.worizon.test">TestServer.IRequester</a></strong></code>
<div class="block">Adapter interface</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="nested_classes_inherited_from_class_java.lang.Thread">
<!--   -->
</a>
<h3>Nested classes/interfaces inherited from class&nbsp;java.lang.Thread</h3>
<code>java.lang.Thread.State, java.lang.Thread.UncaughtExceptionHandler</code></li>
</ul>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_java.lang.Thread">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;java.lang.Thread</h3>
<code>MAX_PRIORITY, MIN_PRIORITY, NORM_PRIORITY</code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../com/worizon/test/TestServer.html#TestServer(int)">TestServer</a></strong>(int&nbsp;port)</code>
<div class="block">Constructor</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../com/worizon/test/TestServer.IRequester.html" title="interface in com.worizon.test">TestServer.IRequester</a></code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.html#createTestRequester()">createTestRequester</a></strong>()</code>
<div class="block">Builds the wrapped version of the adapter to make the request.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.lang.Object</code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.html#createTestRequester(java.lang.Object, java.lang.String)">createTestRequester</a></strong>(java.lang.Object&nbsp;obj,
                   java.lang.String&nbsp;requestMethod)</code>
<div class="block">Builds proxied version of the requester and intercept requestMethod to mute network errors.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../com/worizon/test/TestServer.IRequester.html" title="interface in com.worizon.test">TestServer.IRequester</a></code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.html#createTestRequester(java.lang.String)">createTestRequester</a></strong>(java.lang.String&nbsp;endpoint)</code>
<div class="block">Builds the wrapped version of the adapter to make the request.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.html#dumpHeaders()">dumpHeaders</a></strong>()</code>
<div class="block">Prints request's headers sent.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.html#getBody()">getBody</a></strong>()</code>
<div class="block">Gets the request's body payload sent.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.lang.Object</code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.html#getBodyAsObject()">getBodyAsObject</a></strong>()</code>
<div class="block">Transform body into object with a string-to-object mapper.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.html#getCommand()">getCommand</a></strong>()</code>
<div class="block">Gets the request's command sent.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.util.Map&lt;java.lang.String,java.lang.String&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.html#getHeaders()">getHeaders</a></strong>()</code>
<div class="block">Gets request's headers sent.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.html#setAdapter(com.worizon.test.TestServer.IRequester)">setAdapter</a></strong>(<a href="../../../com/worizon/test/TestServer.IRequester.html" title="interface in com.worizon.test">TestServer.IRequester</a>&nbsp;adapter)</code>
<div class="block">Sets the requester adapter for this server.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.html#setBodyMapper(com.worizon.test.TestServer.IMapper)">setBodyMapper</a></strong>(<a href="../../../com/worizon/test/TestServer.IMapper.html" title="interface in com.worizon.test">TestServer.IMapper</a>&nbsp;mapper)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../com/worizon/test/TestServer.html#setIdleTime(int)">setIdleTime</a></strong>(int&nbsp;idleTime)</code>
<div class="block">Sets the idle time the server will take to read the requests.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_com.worizon.test.BaseServer">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;com.worizon.test.<a href="../../../com/worizon/test/BaseServer.html" title="class in com.worizon.test">BaseServer</a></h3>
<code><a href="../../../com/worizon/test/BaseServer.html#finish()">finish</a>, <a href="../../../com/worizon/test/BaseServer.html#run()">run</a>, <a href="../../../com/worizon/test/BaseServer.html#start()">start</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Thread">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Thread</h3>
<code>activeCount, checkAccess, countStackFrames, currentThread, destroy, dumpStack, enumerate, getAllStackTraces, getContextClassLoader, getDefaultUncaughtExceptionHandler, getId, getName, getPriority, getStackTrace, getState, getThreadGroup, getUncaughtExceptionHandler, holdsLock, interrupt, interrupted, isAlive, isDaemon, isInterrupted, join, join, join, resume, setContextClassLoader, setDaemon, setDefaultUncaughtExceptionHandler, setName, setPriority, setUncaughtExceptionHandler, sleep, sleep, stop, stop, suspend, toString, yield</code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>equals, getClass, hashCode, notify, notifyAll, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="TestServer(int)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>TestServer</h4>
<pre>public&nbsp;TestServer(int&nbsp;port)
           throws java.io.IOException</pre>
<div class="block">Constructor</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="setIdleTime(int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setIdleTime</h4>
<pre>public&nbsp;void&nbsp;setIdleTime(int&nbsp;idleTime)</pre>
<div class="block">Sets the idle time the server will take to read the requests. This idle time is used to test readtimeouts.</div>
</li>
</ul>
<a name="getBody()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getBody</h4>
<pre>public&nbsp;java.lang.String&nbsp;getBody()</pre>
<div class="block">Gets the request's body payload sent.</div>
</li>
</ul>
<a name="setBodyMapper(com.worizon.test.TestServer.IMapper)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setBodyMapper</h4>
<pre>public&nbsp;void&nbsp;setBodyMapper(<a href="../../../com/worizon/test/TestServer.IMapper.html" title="interface in com.worizon.test">TestServer.IMapper</a>&nbsp;mapper)</pre>
</li>
</ul>
<a name="getBodyAsObject()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getBodyAsObject</h4>
<pre>public&nbsp;java.lang.Object&nbsp;getBodyAsObject()</pre>
<div class="block">Transform body into object with a string-to-object mapper.</div>
</li>
</ul>
<a name="getCommand()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCommand</h4>
<pre>public&nbsp;java.lang.String&nbsp;getCommand()</pre>
<div class="block">Gets the request's command sent.</div>
</li>
</ul>
<a name="dumpHeaders()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>dumpHeaders</h4>
<pre>public&nbsp;void&nbsp;dumpHeaders()</pre>
<div class="block">Prints request's headers sent.</div>
</li>
</ul>
<a name="getHeaders()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getHeaders</h4>
<pre>public&nbsp;java.util.Map&lt;java.lang.String,java.lang.String&gt;&nbsp;getHeaders()</pre>
<div class="block">Gets request's headers sent.</div>
</li>
</ul>
<a name="setAdapter(com.worizon.test.TestServer.IRequester)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setAdapter</h4>
<pre>public&nbsp;void&nbsp;setAdapter(<a href="../../../com/worizon/test/TestServer.IRequester.html" title="interface in com.worizon.test">TestServer.IRequester</a>&nbsp;adapter)</pre>
<div class="block">Sets the requester adapter for this server.</div>
</li>
</ul>
<a name="createTestRequester(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>createTestRequester</h4>
<pre>public&nbsp;<a href="../../../com/worizon/test/TestServer.IRequester.html" title="interface in com.worizon.test">TestServer.IRequester</a>&nbsp;createTestRequester(java.lang.String&nbsp;endpoint)</pre>
<div class="block">Builds the wrapped version of the adapter to make the request.</div>
</li>
</ul>
<a name="createTestRequester()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>createTestRequester</h4>
<pre>public&nbsp;<a href="../../../com/worizon/test/TestServer.IRequester.html" title="interface in com.worizon.test">TestServer.IRequester</a>&nbsp;createTestRequester()</pre>
<div class="block">Builds the wrapped version of the adapter to make the request.</div>
</li>
</ul>
<a name="createTestRequester(java.lang.Object, java.lang.String)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>createTestRequester</h4>
<pre>public&nbsp;java.lang.Object&nbsp;createTestRequester(java.lang.Object&nbsp;obj,
                                   java.lang.String&nbsp;requestMethod)</pre>
<div class="block">Builds proxied version of the requester and intercept requestMethod to mute network errors.</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TestServer.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/worizon/test/BaseServer.html" title="class in com.worizon.test"><span class="strong">PREV CLASS</span></a></li>
<li><a href="../../../com/worizon/test/TestServer.IMapper.html" title="interface in com.worizon.test"><span class="strong">NEXT CLASS</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/worizon/test/TestServer.html" target="_top">FRAMES</a></li>
<li><a href="TestServer.html" target="_top">NO FRAMES</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>SUMMARY:&nbsp;</li>
<li><a href="#nested_class_summary">NESTED</a>&nbsp;|&nbsp;</li>
<li><a href="#fields_inherited_from_class_java.lang.Thread">FIELD</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">CONSTR</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">METHOD</a></li>
</ul>
<ul class="subNavList">
<li>DETAIL:&nbsp;</li>
<li>FIELD&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">CONSTR</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">METHOD</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
